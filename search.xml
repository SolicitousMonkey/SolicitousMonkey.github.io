<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç®€å•çš„ledé©±åŠ¨ç¨‹åº</title>
      <link href="/2023/11/07/%E7%AE%80%E5%8D%95%E7%9A%84led%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/"/>
      <url>/2023/11/07/%E7%AE%80%E5%8D%95%E7%9A%84led%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1>æœ€ç®€å•çš„ledé©±åŠ¨ç¨‹åº</h1><p><strong>é©±åŠ¨ç¨‹åºï¼š</strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/poll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mutex.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/uaccess.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/io.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> major;</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="keyword">class</span> *<span class="title">led_class</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* registers */</span></span><br><span class="line"><span class="comment">// IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3åœ°å€ï¼š0x02290000 + 0x14</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">volatile</span> <span class="type">unsigned</span> *IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3; <span class="comment">// ä¸å¯ä»¥ä½¿ç”¨ç‰©ç†åœ°å€æ¥è®¿é—®å¯„å­˜å™¨ï¼Œä¸€å®šè¦ç”¨è™šæ‹Ÿåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GPIO5_GDIRåœ°å€ï¼š0x020AC004</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">volatile</span> <span class="type">unsigned</span> *GPIO5_GDIR;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GPIO5_DRåœ°å€ï¼š0x020AC000; ç”¨æ¥è®¾ç½®é«˜ä½ç”µå¹³</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">volatile</span> <span class="type">unsigned</span> *GPIO5_DR;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">led_write</span><span class="params">(<span class="keyword">struct</span> file *filp, <span class="type">const</span> <span class="type">char</span> __user *buf, </span></span><br><span class="line"><span class="params">                        <span class="type">size_t</span> count, <span class="type">loff_t</span> *ppos)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ä»appè·å¾—æ•°æ®ï¼Œè®¾ç½®gpioæ³¨å†Œå™¨çš„å€¼</span></span><br><span class="line">    <span class="type">char</span> val;</span><br><span class="line">    copy_from_user(&amp;val, buf, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (val)</span><br><span class="line">    &#123;</span><br><span class="line">        *GPIO5_DR &amp;= ~(<span class="number">1</span>&lt;&lt;<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        *GPIO5_DR |= ~(<span class="number">1</span>&lt;&lt;<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">led_open</span><span class="params">(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *filp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* enable gpio5</span></span><br><span class="line"><span class="comment">     * configure gpio5_io3 as gpio</span></span><br><span class="line"><span class="comment">     * configure gpio5_io3 as output</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   *IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3 &amp;= ~<span class="number">0xf</span>;    <span class="comment">// å…ˆæ¸…ç©º</span></span><br><span class="line">   *IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3 |= ~<span class="number">0x5</span>;    <span class="comment">// 0x5 å°±æ˜¯ 101</span></span><br><span class="line"></span><br><span class="line">    *GPIO5_GDIR |= (<span class="number">1</span>&lt;&lt;<span class="number">3</span>); <span class="comment">// å› ä¸ºè¯¥å¯„å­˜å™¨çš„ç¬¬ä¸‰ä½è®¾ä¸º1æ˜¯è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operation</span> <span class="title">led_fops</span> =</span> </span><br><span class="line">&#123;</span><br><span class="line">    .owner = THIS_MODULE,</span><br><span class="line">    .open  = led_open(),</span><br><span class="line">    .write = led_write(),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. å…¥å£å‡½æ•° */</span></span><br><span class="line"><span class="comment">// static è¡¨ç¤ºå‡½æ•°ä»…åœ¨å½“å‰æ–‡ä»¶å†…å¯è§ï¼Œä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">// è¿™å¯¹äºå†…æ ¸æ¨¡å—ç¼–ç¨‹å¾ˆé‡è¦ï¼Œå› ä¸ºå†…æ ¸æ¨¡å—é€šå¸¸ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆï¼Œéœ€è¦æ§åˆ¶å‡½æ•°çš„å¯è§æ€§ã€‚</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">led_init</span><span class="params">(<span class="type">void</span>)</span>   <span class="comment">// è¿™åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œéœ€è¦ç”¨module_initæ¥ä½¿å…¶ç§°ä¸ºå…¥å£å‡½æ•°</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__)</span><br><span class="line"></span><br><span class="line">    major = register_chrdev(<span class="number">0</span>, <span class="string">&quot;zwm&quot;</span>, &amp;led_fops);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* ioremap */</span></span><br><span class="line">    <span class="comment">// IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3åœ°å€ï¼š0x02290000 + 0x14</span></span><br><span class="line">    IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3 = ioremap(<span class="number">0x02290000</span> + <span class="number">0x14</span>, <span class="number">4</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// GPIO5_GDIRåœ°å€ï¼š0x020AC004</span></span><br><span class="line">    GPIO5_GDIR = ioremap(<span class="number">0x020AC004</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// GPIO5_DRåœ°å€ï¼š0x020AC000; ç”¨æ¥è®¾ç½®é«˜ä½ç”µå¹³</span></span><br><span class="line">    GPIO5_DR = ioremap(<span class="number">0x020AC000</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    led_class =  class_create(THIS_MODULE, <span class="string">&quot;myled&quot;</span>);  <span class="comment">// è¯¥å‡½æ•°ç”¨äºæä¾›ä¸€äº›è¾…åŠ©ä¿¡æ¯ï¼Œç³»ç»Ÿä½¿ç”¨è¿™äº›ä¿¡æ¯åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹</span></span><br><span class="line">    device_create(led_class, <span class="literal">NULL</span>, MKDEV(major, <span class="number">0</span>), <span class="literal">NULL</span>, <span class="string">&quot;myled&quot;</span>); <span class="comment">// ç³»ç»Ÿä¼šåˆ›å»º /dev/myled è¿™ä¸€è®¾å¤‡èŠ‚ç‚¹ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">led_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    iounmap(IOMUXC_SNVS_SW_MUX_CTL_PAD_SNVS_TAMPER3);</span><br><span class="line">    iounmap(GPIO5_GDIR);</span><br><span class="line">    iounmap(GPIO5_DR);</span><br><span class="line"></span><br><span class="line">    device_destory(led_class, MKDEV(major, <span class="number">0</span>)); <span class="comment">// </span></span><br><span class="line">    class_destory(led_class);</span><br><span class="line"></span><br><span class="line">    unregister_chrdev(major, <span class="string">&quot;zwm&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module_init(led_init); <span class="comment">// module_init æ˜¯ä¸€ä¸ªå®</span></span><br><span class="line">module_exit(led_init); <span class="comment">// åŒä¸Š</span></span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç¨‹åºï¼š</strong></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ledtest /dev/myled on</span></span><br><span class="line"><span class="comment">// ledtest /dev/myled off</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd;</span><br><span class="line">    <span class="type">char</span> status = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°ç”¨æ³•</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;dev&gt; &lt;on/off&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// open </span></span><br><span class="line">    fd = open(argv[<span class="number">1</span>], O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// fail</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// write</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;on&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        status = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    write(fd, &amp;status, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é©±åŠ¨å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¥‡å¥‡æ€ªæ€ªçš„ç¢ç¢å¿µ</title>
      <link href="/2023/11/01/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
      <url>/2023/11/01/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h1>2023å¹´11æœˆä»½çš„ç¢ç¢å¿µ</h1><h2 id="11æœˆçš„ç¬¬ä¸€ä¸ªæ˜ŸæœŸ">11æœˆçš„ç¬¬ä¸€ä¸ªæ˜ŸæœŸ</h2><p>emotionï¼šğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­</p><p>ğŸ¸èµ·å› ï¼šæ–°è£¤å­åŒ—æµ·æ€ªå…½æ¼”å”±ï¼Œæœ¬æ¥æ²¡æ‰“ç®—æŠ¢ç¥¨çš„æˆ‘ï¼Œæ€»è§‰å¾—éƒ½å¼€åˆ°å®¶é—¨å£äº†ï¼Œä¸æŠ¢æ€ªå¯æƒœçš„ã€‚</p><blockquote><p>èµ·åˆä¸æ‰“ç®—æŠ¢ç¥¨çš„åŸå› ï¼š</p><ol><li>æ„Ÿè§‰æ–°è£¤å­è¶Šæ¥è¶Šæµè¡ŒåŒ–äº†ï¼Œè§‰å¾—æœ‹å…‹å¤ªåœŸäº†ã€‚</li><li>æ€»è§‰å¾—å¼€æ¼”å”±ä¼šå¤ªä¸åƒæ‘‡æ»šä¹åšçš„äº‹å„¿äº†ï¼Œæ‘‡æ»šä¹å°±åº”è¯¥å¥½å¥½å‘†åœ¨livehouseï¼Œ</li></ol><p>æ”¹å˜å¿ƒæ„çš„åŸå› ï¼š</p><ol><li>å‰ä¸€å¤©æ™šä¸Šçœ‹äº†æœˆå¤æœ€åä¸€é›†çš„æ¼”å”±ä¼šï¼Œæœ‹å…‹è™½ç„¶åœŸï¼Œä½†çœŸçš„å¥½å®¹æ˜“è®©äººå›è¡èµ·è¢«çç¢æ—¥å­ç£¨å¹³çš„æƒ…ç»ªï¼Œä¸ç”¨æ€è€ƒï¼Œæ²¡æœ‰æ™¦æ¶©çš„æ­Œè¯ï¼Œæ²¡æœ‰åˆ»æ„åˆ¶é€ çš„æ·±åˆ»ï¼Œæ²¡æœ‰å¯¹ç¤¾ä¼šçš„è‹¦å¤§ä»‡æ·±ä¸æŠ¨å‡»ã€‚æˆ‘åœ¨è¿™æ€»æ˜¯èƒ½æ„Ÿåˆ°è£¸éœ²çš„æƒ…ç»ªï¼Œä¸ºè‡ªå·±è¿˜èƒ½æ„Ÿå—ä¸–ç•Œè€Œåº†å¹¸ã€‚</li><li>ç¬¬äºŒä¸ªåŸå› å°±æ˜¯è·ç¦»çœŸçš„å¤ªè¿‘äº†ï¼Œç¦»å­¦æ ¡åªæœ‰ä¸åˆ°2kmçš„è·ç¦»ã€‚</li></ol></blockquote><p>ğŸŒ¸ç»è¿‡ï¼šä¸‹åˆå››ç‚¹çªç„¶æ”¶åˆ°æ–°è£¤å­æ¼”å”±ä¼šæ”¾ç¥¨çš„ä¿¡æ¯ï¼Œç‚¹è¿›å»ä¸€çœ‹å‘ç°280ã€580ã€780ã€980çš„ç¥¨éƒ½æœ‰ï¼Œæˆ‘å½“æœºç«‹æ–­å°±æƒ³èµ·å‰ä¸€å¤©æ™šä¸Šæƒ³åˆ°å¦‚æœæœ‰ç¥¨çš„è¯å«ä¸ŠFLå“¥ï¼Œä½†æ˜¯ä¹‹å‰æ ¹æœ¬æ²¡å½•å…¥ä»–ä»¬çš„ä¸ªäººèº«ä»½ä¿¡æ¯ï¼Œä¹°ç¥¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°å½•å…¥ï¼Œä¸€é€šä¸‹æ¥æœ¬æ¥å¯ä»¥æŠ¢åˆ°280ç¥¨çš„æˆ‘ï¼Œç¡¬ç”Ÿç”Ÿå› ä¸ºå½•å…¥ä»–ä»¬çš„ä¿¡æ¯èŠ±äº†å¤ªå¤šæ—¶é—´ï¼Œé”™è¿‡280çš„ç¥¨ã€‚æ­¤æ—¶å·²ç»å¾ˆå†²åŠ¨äº†ï¼Œæƒ³è¦å»çœ‹æ¼”å”±ä¼šçš„å¿ƒæƒ…è¾¾åˆ°å³°å€¼ï¼Œç®€å•è¯¢é—®äº†ä¸€ä¸‹å°±ä¹°äº†580çš„ç¥¨ä¹˜4ï¼ï¼ï¼ï¼</p><p>ğŸŒ°ç»“æœï¼šå¤ªè´µäº†ï¼ï¼å¤ªäºäº†ï¼ï¼è¿˜ä¸èƒ½é€€ç¥¨ï¼ï¼é€€ç¥¨è¦æ”¶20%çš„æ‰‹ç»­è´¹ï¼ï¼æçš„FLå“¥å’Œç« é±¼å“¥è«åæ”¯å‡ºäº†ä¸€å¤§ç¬”é’±ï¼Œå…³é”®æ˜¯åŸæœ¬æ˜¯ä¸æƒ³çœ‹çš„ï¼Œå°±ç®—æƒ³çœ‹ä¹Ÿæ˜¯æœ€ä¾¿å®œçš„ç¥¨ï¼Œä¸€ä¸‹å­å°±æ¯”åŸè®¡åˆ’å¤šèŠ±äº†ä¸‰ç™¾å—ï¼ï¼ï¼è€Œä¸”å…¶å®å¤§å®¶éƒ½äº’ç›¸ä¸è®¤è¯†ï¼Œæ„Ÿè§‰ä¼šå°´å°¬ã€‚</p><p>è€Œä¸”FLå“¥æ„Ÿè§‰æ²¡æœ‰å¾ˆæƒ³å»ï¼Œè¿™æ³¢æ˜¯æ“…è‡ªç»™åˆ«äººåšå†³å®šäº†ï¼Œæœ¬æ¥æ˜¯æ‰“ç®—ä¹°280çš„ç¥¨ç„¶åå°±è¯·ä»–çœ‹çš„ï¼Œå› ä¸ºå†²åŠ¨ä¹°ç¥¨çš„è¡Œä¸ºå¯¼è‡´ä¹Ÿè¯·ä¸èµ·äº†ã€‚</p><p>ğŸ˜­ å¯¼è‡´ï¼šemoäº†ä¸€ä¸‹åˆï¼Œè§‰å¾—è‡ªå·±åšäº‹æƒ…å¤ªå†²åŠ¨å¤ªå†²åŠ¨ï¼Œå¤ªä¸æˆç†Ÿï¼Œä»¥æ­¤ä¸ºé‰´ï¼Œå¾—å‡ºä¸€äº›ç»“è®ºï¼Œå¸Œæœ›ä»¥åèƒ½å‡å°‘æ­¤ç±»äº‹æƒ…çš„å‘ç”Ÿï¼š</p><p>ğŸŒå¿ƒå¾—ï¼š</p><ol><li><strong>æå‰ç¡®å®šå¥½ä¹°ç¥¨äººï¼Œä¸è¦ä¸´æ—¶æ›´æ”¹</strong>ã€‚å¦‚æœæœ‰ä¸´æ—¶æƒ³å«çš„äººï¼Œå…ˆç®¡å¥½å·²ç»å®šä¸‹æ¥çš„ï¼Œå†å»é—®åˆ«äººã€‚</li><li>æå‰å½•å…¥ä¹°ç¥¨äººä¿¡æ¯å’Œå–ç¥¨åœ°å€ã€‚</li><li>ä¸ä¸€å®šè¦ä¸€èµ·ä¹°ï¼Œä¸ç”¨ä¸ºäº†è¿åº§ç‰¹åœ°ä¸€èµ·ä¹°ç¥¨ï¼Œ<strong>æ²¡æœ‰æŠ¢åˆ°ç¥¨ä¸€åˆ‡éƒ½æ˜¯å¾’åŠ³çš„</strong>ã€‚</li><li>åªä¹°æœ€ä¾¿å®œä¸€æ¡£çš„ç¥¨ï¼æ²¡æœ‰äº†å°±ä¸ä¹°ï¼å› ä¸ºæ€»ä¼šç­‰åˆ°æœ‰äººå‡ºçš„ï¼ï¼</li><li>é¢å¯¹çªå¦‚å…¶æ¥çš„ç¥¨ï¼Œå…ˆç®¡è‡ªå·±çš„ï¼Œå†å»ç®¡åˆ«äººçš„ï¼Œä¸å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ã€‚</li></ol><p>å°†è¯¥æŠ¢ç¥¨å¿ƒå¾—æ˜ å°„åˆ°å…¶ä»–çš„äº‹æƒ…ä¸Šï¼š</p><ol><li>ä¸è¦åœ¨å¿ƒæ€¥çš„æ—¶å€™åšå†³å®šï¼ä¸è¦è¢«çªå¦‚å…¶æ¥çš„è®¡åˆ’æ”¹å˜ä¹±äº†é˜µè„šï¼å¦‚æœå®åœ¨è®¡åˆ’æœ‰å˜ï¼Œè€ƒè™‘æ­¤äº‹äº‹å…³è‡ªå·±è¿˜æ˜¯äº‹å…³ä»–äººï¼Œ</li><li><strong>å¦‚è‹¥äº‹å…³ä»–äºº</strong>ï¼Œåˆ™ä¸è¦è½»æ˜“æ”¹å˜è®¡åˆ’ï¼Œåˆ«äººä¸ä¸€å®šèƒ½æ¥å—çªç„¶çš„æ”¹å˜ï¼Œå¹¶ä¸”è®¡åˆ’çš„æ”¹å˜é€šå¸¸ä»¥ä¸ºç€è¦ä»˜å‡ºä»£ä»·ï¼Œåˆ«äººä¸ä¸€å®šèƒ½å¤Ÿæ¥å—è¿™æ ·çš„ä»£ä»·ã€‚</li><li><strong>å¦‚æœäº‹å…³è‡ªå·±</strong>ï¼Œå¯ä»¥äº‰å–æ”¹å˜ï¼Œæ¯•ç«Ÿè‡ªå·±èƒ½å¤Ÿæ‰¿æ‹…è‡ªå·±åšçš„äº‹æƒ…å¸¦æ¥çš„ä»£ä»·ã€‚</li></ol><p>è¿™æ¬¡å°±ç®—äº†ï¼Œå¥½å¥½äº«å—è¿™ä¸€åœºæ¼”å”±ä¼šï¼Œæƒ³å¤ªå¤šä¹Ÿæ²¡æœ‰ç”¨ï¼ŒæœŸå¾…æ¼”å‡ºæ</p><p><img src="image-20231101210351116.png" alt="image-20231101210351116"></p><p>æœ€åé™„ä¸Šæ–°è£¤å­çš„ä¸€é¦–æ­Œï¼Œæ­Œåä¸ä»Šæ—¥æ„Ÿå—ååˆ†è´´åˆ‡ï¼ŒğŸ§   ----&gt;  <a href="https://music.163.com/#/song?id=2033879001">è’åºŸçš„ä¸€å¤©</a></p><p>END/</p><hr>]]></content>
      
      
      
        <tags>
            
            <tag> æœ¬äººçš„ç¢ç¢å¿µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é©±åŠ¨å¼€å‘å…¥é—¨</title>
      <link href="/2023/10/26/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/"/>
      <url>/2023/10/26/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¼–å†™é©±åŠ¨æ­¥éª¤">ç¼–å†™é©±åŠ¨æ­¥éª¤</h2><ol><li>ç¡®å®šä¸»è®¾å¤‡å·</li><li>å®šä¹‰è‡ªå·±çš„<code>file_operator</code>ç»“æ„ä½“</li><li>å®ç°å¯¹åº”çš„<code>open\read\write</code>ç­‰å‡½æ•°ï¼Œå¡«å…¥<code>file_operator</code>ç»“æ„ä½“</li><li>æŠŠ<code>file_operator</code>ç»“æ„ä½“å‘Šè¯‰å†…æ ¸ï¼šæ³¨å†Œé©±åŠ¨ç¨‹åº</li><li>å…¥å£å‡½æ•°ï¼šå®‰è£…é©±åŠ¨ç¨‹åºæ—¶å°±ä¼šè°ƒç”¨è¯¥å…¥å£å‡½æ•°</li><li>å‡ºå£å‡½æ•°ï¼šå¸è½½é©±åŠ¨ç¨‹åºæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥å‡ºå£å‡½æ•°</li><li>å…¶ä»–å®Œå–„ï¼šæä¾›è®¾å¤‡ä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹</li></ol><h2 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„helloé©±åŠ¨ï¼ˆä¸æ¶‰åŠç¡¬ä»¶ï¼‰">ç¼–å†™ä¸€ä¸ªç®€å•çš„helloé©±åŠ¨ï¼ˆä¸æ¶‰åŠç¡¬ä»¶ï¼‰</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/miscdevice.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/major.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mutex.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/proc_fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seq_file.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/tty.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kmod.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/gfp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. ç¡®å®šä¸»è®¾å¤‡å· */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> major = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> kernel_buf[<span class="number">1024</span>];</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="keyword">class</span> *<span class="title">hello_class</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(a, b)   (a&lt;b?a : b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. å®ç°å¯¹åº”çš„openã€readã€writeå‡½æ•°ï¼Œå¡«å…¥file_operationç»“æ„ä½“ */</span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">hello_drv_read</span> <span class="params">(<span class="keyword">struct</span> file *file, <span class="type">char</span> __user *buf, <span class="type">size_t</span> size, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">    copy_to_user(buf, kernel_buf, MIN(<span class="number">1024</span>, size));</span><br><span class="line">    <span class="keyword">return</span> MIN(<span class="number">1024</span>, size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">hello_drv_write</span> <span class="params">(<span class="keyword">struct</span> file *file, <span class="type">const</span> <span class="type">char</span> __user *buf, <span class="type">size_t</span> size, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">    copy_from_user(kernel_buf, buf, MIN(<span class="number">1024</span>, size));</span><br><span class="line">    <span class="keyword">return</span> MIN(<span class="number">1024</span>, size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">hello_drv_open</span> <span class="params">(<span class="keyword">struct</span> inode *node, <span class="keyword">struct</span> file *file)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">hello_drv_close</span> <span class="params">(<span class="keyword">struct</span> inode *node, <span class="keyword">struct</span> file *file)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. å®šä¹‰è‡ªå·±çš„file_operationç»“æ„ä½“ */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operation</span> <span class="title">hello_drv</span> =</span> &#123;</span><br><span class="line">    .owner  = THIS_MODULW,</span><br><span class="line">    .open   = hello_drv_open,</span><br><span class="line">    .read   = hello_drv_read,</span><br><span class="line">    .write  = hello_drv_write,</span><br><span class="line">    .release = hello_drv_close,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4. æ³¨å†Œé©±åŠ¨ç¨‹åºï¼ŒæŠŠfile_operationç»“æ„ä½“å‘Šè¯‰å†…æ ¸ */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 5. å…¥å£å‡½æ•° */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">hello_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> err;</span><br><span class="line">    printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"></span><br><span class="line">    major = register_chrdev(<span class="number">0</span>, <span class="string">&quot;hello&quot;</span>, &amp;hello_drv); </span><br><span class="line"></span><br><span class="line">    hello_class = class_create(THIS_MODULE, <span class="string">&quot;hello_class&quot;</span>); <span class="comment">/* /dev/hello */</span></span><br><span class="line">err = PTR_ERR(hello_class);</span><br><span class="line"><span class="keyword">if</span> (IS_ERR(hello_class))</span><br><span class="line">&#123;</span><br><span class="line">        printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">        unregister_chrdev(major, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    device_create(hello_class, <span class="literal">NULL</span>, MKDEV(major, <span class="number">0</span>), <span class="literal">NULL</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 6. å‡ºå£å‡½æ•° */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">hello_exit</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;%s %s line %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">    device_destory(hello_class, MKDEV(major, <span class="number">0</span>));</span><br><span class="line">    class_destory(hello_class);</span><br><span class="line"></span><br><span class="line">    unregister_chrdev(major, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 7. å…¶ä»–å®Œå–„ï¼šæä¾›è®¾å¤‡ä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹ */</span></span><br><span class="line">module_init(hello_init);</span><br><span class="line">module_exit(hello_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li><code>__FILE__</code> æ˜¯é¢„å¤„ç†å™¨å®ï¼Œç”¨äºè¡¨ç¤ºå½“å‰æºæ–‡ä»¶åã€‚</li><li><code>__FUNCTION__</code> æ˜¯ç¼–è¯‘å™¨å®ï¼Œç”¨äºè¡¨ç¤ºå½“å‰å‡½æ•°åã€‚</li><li><code>__LINE__</code> æ˜¯é¢„å¤„ç†å™¨å®ï¼Œç”¨äºè¡¨ç¤ºå½“å‰è¡Œå·ã€‚</li></ul><p>è¿™äº›å®å¸¸ç”¨äºè°ƒè¯•ï¼Œä»¥äº†è§£ä»£ç çš„æ‰§è¡Œä½ç½®ã€‚</p><ul><li><code>printk</code> æ˜¯Linuxå†…æ ¸ä¸­ç”¨äºæ‰“å°è°ƒè¯•ä¿¡æ¯çš„å‡½æ•°ï¼Œç±»ä¼¼äºCæ ‡å‡†åº“ä¸­çš„ <code>printf</code>ã€‚</li></ul><hr><h3 id="ä¸¤ç§ä¸‰æç®¡">ä¸¤ç§ä¸‰æç®¡</h3><p>Næ˜¯è´Ÿæ</p><p><img src="image-20231027162836427.png" alt="ä¸‰æç®¡"></p><hr><h3 id="GPIO">GPIO</h3><p><strong>å››ä¸ªæ­¥éª¤</strong>:</p><ol><li>ä½¿èƒ½ power/clock</li><li>pinâ€™modeå¯ä»¥æ˜¯uartæˆ–gpioç­‰ç­‰ï¼Œå› æ­¤è¦é€‰æ‹©pinâ€™mode</li><li>æ–¹å‘ï¼šè¯» or å†™</li><li>æ•°æ®ï¼šé«˜ç”µå¹³ or ä½ç”µå¹³</li></ol><p><img src="image-20231027163401069.png" alt="GPIO"></p>]]></content>
      
      
      
        <tags>
            
            <tag> é©±åŠ¨å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
